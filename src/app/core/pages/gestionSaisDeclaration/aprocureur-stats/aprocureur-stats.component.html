<div class="dashboard-container">
  <!-- Header amélioré avec sélecteur d'année -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <i class="fas fa-gavel"></i> Tableau de bord - Procureur Général
      </h1>
      <div class="header-actions">
        <div class="year-selector">
          <button (click)="selectedYear = selectedYear - 1; onYearChange(selectedYear)">
            <i class="fas fa-chevron-left"></i>
          </button>
          <span>{{ selectedYear }}</span>
          <button (click)="selectedYear = selectedYear + 1; onYearChange(selectedYear)" 
                  [disabled]="selectedYear >= currentYear">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <button 
          type="button" 
          class="refresh-btn"
          (click)="refreshData()"
          [disabled]="isLoading">
          <span *ngIf="!isLoading"><i class="fas fa-sync-alt"></i> Actualiser</span>
          <span *ngIf="isLoading"><i class="fas fa-spinner fa-spin"></i> Chargement...</span>
        </button>
      </div>
    </div>
    <div class="header-stats">
      <div class="stat-item">
        <div class="stat-value">{{ totalDeclarations | number }}</div>
        <div class="stat-label">Déclarations totales</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ procureurStats.dossiersEnCours || 0 | number }}</div>
        <div class="stat-label">Dossiers en cours</div>
      </div>
      <div class="stat-item">
        <div class="stat-value">{{ procureurStats.tauxAcceptation || 0 }}%</div>
        <div class="stat-label">Taux d'acceptation</div>
      </div>
    </div>
  </div>
  
  <!-- Section principale -->
  <div class="dashboard-main">
    <!-- Cartes d'informations principales avec nouveau design -->
    <div class="info-cards-grid" *ngIf="!isLoading">
      <div class="info-card card-1">
        <div class="card-content">
          <div class="card-icon">
            <i class="fas fa-file-alt"></i>
          </div>
          <div class="card-text">
            <h3>Total des déclarations</h3>
            <div class="big-number">{{ totalDeclarations | number }}</div>
            <div class="card-trend positive">
              <i class="fas fa-arrow-up"></i> +12% vs mois dernier
            </div>
          </div>
        </div>
      </div>
      
      <div class="info-card card-2">
        <div class="card-content">
          <div class="card-icon">
            <i class="fas fa-folder-open"></i>
          </div>
          <div class="card-text">
            <h3>Dossiers en cours</h3>
            <div class="big-number">{{ procureurStats.dossiersEnCours || 0 | number }}</div>
            <div class="card-status">
              <span class="status-badge">En traitement</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="info-card card-3">
        <div class="card-content">
          <div class="card-icon">
            <i class="fas fa-gavel"></i>
          </div>
          <div class="card-text">
            <h3>Décisions rendues</h3>
            <div class="big-number">{{ procureurStats.decisionsRendues || 0 | number }}</div>
            <div class="card-subtext">Ce mois-ci</div>
          </div>
        </div>
      </div>
      
      <div class="info-card card-4">
        <div class="card-content">
          <div class="card-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="card-text">
            <h3>Taux d'acceptation</h3>
            <div class="big-number">{{ procureurStats.tauxAcceptation || 0 }}%</div>
            <div class="card-subtext">Moyenne annuelle</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chargement avec nouveau design -->
    <div class="loading-overlay" *ngIf="isLoading">
      <div class="loading-content">
        <div class="spinner">
          <div class="double-bounce1"></div>
          <div class="double-bounce2"></div>
        </div>
        <p>Chargement des données...</p>
        <div class="progress-bar">
          <div class="progress" [style.width.%]="getLoadingProgress()"></div>
        </div>
      </div>
    </div>

    <!-- Grille des graphiques améliorée -->
    <div class="charts-grid" *ngIf="!isLoading">
      <!-- Nouveau graphique linéaire pour l'évolution mensuelle -->
      <div class="chart-container card">
        <div class="chart-header">
          <h3><i class="fas fa-chart-line"></i> Évolution mensuelle</h3>
          <div class="chart-actions">
            <button class="chart-action-btn" title="Zoom">
              <i class="fas fa-search-plus"></i>
            </button>
            <button class="chart-action-btn" title="Exporter">
              <i class="fas fa-download"></i>
            </button>
          </div>
        </div>
        <div class="chart-wrapper">
          <canvas baseChart
            #monthlyChart
            [data]="monthlyChartData"
            [type]="monthlyChartType"
            [options]="monthlyChartOptions">
          </canvas>
        </div>
      </div>

      <!-- Graphique en barres pour les décisions -->
      <div class="chart-container card">
        <div class="chart-header">
          <h3><i class="fas fa-balance-scale"></i> Décisions rendues</h3>
          <div class="chart-legend">
            <span><span class="legend-color" style="background: #4CAF50;"></span> Acceptées</span>
            <span><span class="legend-color" style="background: #FF9800;"></span> Refusées</span>
          </div>
        </div>
        <div class="chart-wrapper">
          <canvas baseChart
            #barChart
            [data]="barChartData"
            [type]="barChartType"
            [options]="barChartOptions">
          </canvas>
        </div>
      </div>

      <!-- Nouveau graphique annuel -->
      <div class="chart-container card">
        <div class="chart-header">
          <h3><i class="fas fa-calendar-alt"></i> Comparaison annuelle</h3>
          <select class="year-select" (change)="onYearChange($event.target.value)">
            <option *ngFor="let year of [currentYear-4, currentYear-3, currentYear-2, currentYear-1, currentYear]" 
                    [value]="year" [selected]="year === selectedYear">
              {{ year }}
            </option>
          </select>
        </div>
        <div class="chart-wrapper">
          <canvas baseChart
            #yearlyChart
            [data]="yearlyChartData"
            [type]="yearlyChartType"
            [options]="yearlyChartOptions">
          </canvas>
        </div>
      </div>

      <!-- Graphique en secteurs pour les types de rapports -->
      <div class="chart-container card">
        <div class="chart-header">
          <h3><i class="fas fa-chart-pie"></i> Types de rapports</h3>
          <div class="chart-legend">
            <span><span class="legend-color" style="background: #FFA000;"></span> Provisoires</span>
            <span><span class="legend-color" style="background: #4CAF50;"></span> Définitifs</span>
          </div>
        </div>
        <div class="chart-wrapper">
          <canvas baseChart
            #pieChart
            [data]="pieChartData"
            [type]="pieChartType"
            [options]="pieChartOptions">
          </canvas>
        </div>
      </div>

      <!-- Graphique des types de déclaration -->
      <div class="chart-container card">
        <div class="chart-header">
          <h3><i class="fas fa-file-signature"></i> Types de déclarations</h3>
          <div class="chart-legend">
            <span>Répartition par catégorie</span>
          </div>
        </div>
        <div class="chart-wrapper">
          <canvas baseChart
            #declarationTypeChart
            [data]="declarationTypeChartData"
            [type]="declarationTypeChartType"
            [options]="declarationTypeChartOptions">
          </canvas>
        </div>
      </div>

     
</div>